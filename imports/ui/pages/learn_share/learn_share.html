<template name="learn_share">
  {{#if canEditAdmin}}
  <script src="https://swx.cdn.skype.com/shared/v/1.2.15/SkypeBootstrap.min.js"></script>
  {{/if}}
  {{#if Template.subscriptionsReady}}
  <div class="container" data-lssid="{{ lssid }}">
    {{#unless currentUser}}
    {{#if sessionActive}}
    <div class="row spaced">
      <div class="label label-info">
        You are participating as
        <span
          class="guest-name"
          id="guest-name-edit"
          data-toggle="modal"
          data-target="#modal-edit-name"
          >{{ guestName }} <span class="glyphicon glyphicon-edit"></span
        ></span>
      </div>
    </div>
    {{/if}}
    {{/unless}}
    <div class="row spaced">
      <div class="col-sm-10">
        <h1>
          Learn<img
            src="/img/DeveloperLevel_icon_bg.png"
            class="dl-icon"
          />Share
        </h1>
        {{#if teamId}}
        <h1 class="teamInfo">
          {{> team_icon team=team}} {{ teamName }}
          {{ #if sessionActive }}
          <span class="glyphicon glyphicon-edit" id="editTeam"></span>
          {{ /if }}
        </h1>

        {{/if}}

        {{ #if sessionActive }}
        <div class="input-group" id="toggleTeam">
          <select id="select-team1">
            <option value="" selected disabled>Select Team</option>
            {{#each t in teamList}}
              <option value="{{ t._id }}" {{teamSelected t.Name}}>{{ t.Name }}</option>
            {{/each}}
          </select>
        </div>
        {{ /if }}

        <div>Session title</div>
        <div>
          {{#if canEditAdmin}}
          <input
            class="form-control input-lg flat"
            value="{{ title }}"
            id="input-title"
          />
          {{else}}
          <input
            class="form-control input-lg flat"
            value="{{ title }}"
            id="input-title"
            disabled
          />
          {{/if}}
        </div>
      </div>
      <div class="col-sm-2 text-right">
        {{#if sessionActive}}
        <div class="label label-info">
          <a href="#" id="lockSession"
            ><span class="glyphicon glyphicon-lock"> Active</span></a
          >
        </div>
        {{else}}
        <div class="label label-warning">
          <a href="#" id="unlockSession"
            ><span class="glyphicon glyphicon-lock"> Locked</span></a
          >
        </div>
        {{/if}}
      </div>
    </div>
    <div class="row spaced">
      <div class="col-sm-6">
        Skype URL:
        {{#if canEditAdmin}}
        {{#if skypeUrl}}
        <span id="span-create-skype" style="display:none;"
          >(<a href="#" id="a-create-call">Create skype meeting</a>)</span
        >
        <a id="a-skype-url" href="{{ skypeUrl }}" target="_blank">{{
          skypeUrl
        }}</a>
        <a id="a-skype-url-edit" href="#"
          ><span class="glyphicon glyphicon-edit"></span
        ></a>
        <input
          type="text"
          id="input-skype-url"
          class="form-control"
          value="{{ skypeUrl }}"
          style="display:none"
        />
        {{else}}
        <span id="span-create-skype"
          >(<a href="#" id="a-create-call">Create skype meeting</a>)</span
        >
        <input type="text" id="input-skype-url" class="form-control" />
        {{/if}}
        {{else}}
        <a href="{{ skypeUrl }}" target="_blank">{{ skypeUrl }}</a>
        {{/if}}
      </div>
    </div>
    <div class="row spaced">
      <div class="col-sm-4">
        <div class="row spaced">
          <div class="col-sm-12">
            Participants
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            <div class="control-group">
              {{#if canEdit}}
              {{> select_autocomplete id="select-participants" id2="" name="participants[]" placeholder="Choose session participants..." list=userAddList selected=sessionParticipantItems onItemRemove=itemRemoveHandler onItemAdd=itemAddHandler create="1" nextParticipant=sessionNextParticipant}}
              {{else}}
              {{> label_list items=sessionParticipantItems labelType="label-warning"}}
              {{/if}}
            </div>
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            Guests
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            <div class="control-group guestList">
              {{#if canEdit}}
              {{> select_autocomplete id="select-guests" id2="" name="guests[]" placeholder="Choose session guests..." list=userAddList selected=sessionGuestItems onItemRemove=itemRemoveGuestHandler onItemAdd=itemAddGuestHandler create="1"}}
              {{else}}
              {{> label_list items=sessionGuestItems labelType="label-warning"  nextParticipant=sessionNextParticipant}}
              {{/if}}
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="row spaced">
          <div class="col-sm-12">
            &nbsp;
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            {{#if canEditAdmin}}
            <div id="p-pick-first">
              <button id="btn-pick-first" class="btn btn-primary">
                Pick random presenter
              </button>
            </div>
            <div id="p-on-deck" style="display:none">
              <button id="btn-pick-again" class="btn btn-primary">
                Pick again
              </button>
              <button id="btn-pick-accept" class="btn btn-success">
                Accept
              </button>
              <div id="p-on-deck-info" class="jumbotron"></div>
            </div>
            {{/if}}
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="row spaced presenterKey">
          <div class="col-md-12 countdownTimer">
            Session Time
            <div class="startSession">
              {{#if isHost}}
              <div class="control-group guestList">
                <input
                  name="session-length"
                  class="form-control"
                  id="session-length"
                  type="number"
                  value="60"
                />
                <span class="text-sm">(minutes)</span>
                <div class="btn btn-primary pull-right" id="cdtimerbtn">
                  Start Session
                </div>
              </div>
              {{/if}}
              <div class="control-group">
                <span class="countdownTimer" id="cdtShow">
                  <!-- {{ remainingTime }} -->
                      {{> timer presenter=sessionCountdown}}
                </span>

              </div>
              
              <!-- {{/if}} -->
              <div class="control-group" id="player-control">
                <span id="countdownTimer" style="display:none;">
                  {{> timer presenter=sessionCountdown}}
                </span>
                {{#if isHost}}
                <span id="cdtimer"></span>
                <div
                  class="btn btn-danger pull-right btn-spacing"
                  id="resettimerbtn"
                >
                  Reset
                </div>
                <div
                  class="btn btn-success pull-right btn-spacing"
                  id="playtimerbtn"
                >
                  Play
                </div>
                <div
                  class="btn btn-primary pull-right btn-spacing"
                  id="pausetimerbtn"
                >
                  Pause
                </div>
                {{/if}}
              </div>
            </div>



          </div>
          <div class="col-sm-12">
            <div class="col-sm-2 pull-left">
              Presenters
            </div>
            <div class="col-sm-10 pull-right allottedTimers">
              Time for Each: <span id="allotted"></span>
            </div>
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            <ul class="list-group" id="ls-presenters">
              {{#each presenter in sessionPresenters}}
              <li class="list-group-item" data-id="{{ presenter.id }}">
                {{order @index}}. {{ presenter.name }}
                <span class="pull-right">{{> timer presenter=presenter}}</span>
              </li>
              {{/each}}
            </ul>
          </div>
        </div>
        <div class="presenter-timers">
            {{#if isHost}}
            <div class="row spaced">
                <div class="col-sm-12">
                    <div class="btn btn-primary col-sm-12" id="pausePTimer">
                        Stop Presenter's Timer
                    </div>
                </div>
            </div>
            <div class="row spaced">
                <div class="col-sm-12">
                    <div class="btn btn-primary col-sm-6 pull-left" id="playPTimer">
                        Play
                    </div>
                    <div class="btn btn-danger col-sm-6 pull-right" id="resetPTimer">
                        Reset
                    </div>
                </div>
            </div>
            {{/if}}
        </div>        
      </div>
    </div>
    <div class="row spaced">
      <div class="col-sm-12">
        {{ > ls_notes }}
      </div>

      <div class="col-sm-4">
        <div class="row spaced">
          <div class="col-sm-12">
            &nbsp;
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            {{#if canEditAdmin}}
            <div id="p-enable-notes">
              <button id="btn-enable-notes" class="btn btn-primary">
                {{ enableNotesText }}
              </button>
            </div>
            {{/if}}
          </div>
        </div>
        <div class="row spaced">
          <div class="col-sm-12">
            &nbsp;
          </div>
        </div>
      </div>
    </div>
    <div class="row spaced">
      <div class="col-sm-12">
        Session Recording
        {{#if canEditAdmin}}
        <input name="recording-upload" class="file-upload-input" type="file" />
        {{/if}}
        <div>
          {{> video_embed id=lssid}}
        </div>
      </div>
    </div>
  </div>
  {{else}}
  {{> loading}}
  {{/if}}

  <div class="modal fade" id="modal-edit-name">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Guest Name</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <input
            id="input-guest-name"
            class="form-control input-lg"
            value="{{ guestName }}"
          />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="modal-save-name">
            Save changes
          </button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="ls_note">
  <style>
    .noteCard {
      padding: 0.5rem;
      border-radius: 2px;
      border: 1px solid #eee;
    }
  </style>
  <div class="card noteCard">
    <section class="card-body">
      <!-- <h5 class="card-title">{{ note.details }}</h5> -->
      <h5 class="card-text">{{ note.details }}</h5>
      <small class="card-subtitle mb-2 text-muted"
        >written by: <span>{{ note.user }}</span></small
      >
    </section>
  </div>
</template>

<template name="ls_notes" data-key="{{ this.lssid }}">
  {{ #if Template.subscriptionsReady }}
  <div class="container">
    <div class="row" style="margin: 1rem 0;">
      {{ #if isHost }}
      <div class="container">
        <a href="#!" id="editPermissionsLink">{{ isEditingEnabled }}</a>
      </div>
      {{ /if }}
      {{ #if notesEnabled }}
      <div class="col-12">
        <textarea
          rows="10"
          type="text"
          name="addNote"
          id="addNote"
          class="form-control"
          placeholder="add a note and hit enter.."
          value={{volatileText}}
        ></textarea>
      </div>
      <div class="col-12">
        <button id="addNotesBtn" class="btn btn-success btn-block">
          Add Note
        </button>
      </div>
      {{ else }}
      <div class="col-12">
        <textarea
          rows="10"
          type="text"
          name="addNote"
          id="addNote"
          class="form-control"
          placeholder="Notes are disabled at this time.  Admins can enable this feature"
          disabled
        ></textarea>
      </div>
      <div class="col-12">
        <button id="addNotesBtn" class="btn btn-success btn-block" disabled>
          Add Note
        </button>
      </div>
      {{ /if }}
    </div>
  </div>
  <div class="container">
    {{ #each note in sessionNotes }}
    {{ > ls_note note=note }}
    {{ /each }}
  </div>
  {{ /if }}
</template>
